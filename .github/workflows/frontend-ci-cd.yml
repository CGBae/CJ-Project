# # .github/workflows/frontend-ci-cd.yml

# name: Frontend CI/CD

# # 1. ì‹¤í–‰ ì¡°ê±´: main ë¸Œëœì¹˜ì— pushë  ë•Œ
# on:
#   push:
#     branches:
#       - Git_CICD  # (ë°±ì—”ë“œì™€ ë™ì¼í•œ ë¸Œëœì¹˜ ì‚¬ìš©)
#     # ğŸ’¡ frontend/ í´ë”ê°€ ë³€ê²½ë  ë•Œë§Œ ì‹¤í–‰
#     paths:
#       - 'frontend/**'
#       - '.github/workflows/frontend-ci-cd.yml'

# jobs:
#   build-and-deploy:
#     # 2. ì‹¤í–‰ í™˜ê²½
#     runs-on: ubuntu-latest

#     steps:
#       # 3. ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
#       - name: Checkout code
#         uses: actions/checkout@v4

#       # 4. Node.js í™˜ê²½ ì„¤ì • (ì˜ˆ: 18.x ë²„ì „)
#       - name: Set up Node.js 18
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'
#           cache: 'npm'
#           # ğŸ’¡ ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ frontend/ ë¡œ ì§€ì •
#           cache-dependency-path: frontend/package-lock.json

#       # 5. í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
#       - name: Install dependencies
#         working-directory: ./frontend
#         run: npm install

#       # 6. (í•„ìˆ˜) í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±
#       #    GitHub Secretsì— ì €ì¥ëœ í‚¤ë¥¼ ì‚¬ìš©í•´ .env.local íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
#       - name: Create .env file
#         working-directory: ./frontend
#         run: |
#           echo "NEXT_PUBLIC_API_BASE_URL=${{ secrets.NEXT_PUBLIC_API_BASE_URL }}" >> .env.local
#           echo "NEXT_PUBLIC_KAKAO_REST_KEY=${{ secrets.NEXT_PUBLIC_KAKAO_REST_KEY }}" >> .env.local
#           echo "NEXT_PUBLIC_KAKAO_REDIRECT_URI=${{ secrets.NEXT_PUBLIC_KAKAO_REDIRECT_URI }}" >> .env.local
#           echo "NEXT_PUBLIC_AUTH_BYPASS=false" >> .env.local
#           echo "--- .env.local created ---"
#           cat .env.local # (í™•ì¸ìš© ë¡œê·¸)
          
#       # 7. (í•„ìˆ˜) Next.js í”„ë¡œì íŠ¸ ë¹Œë“œ
#       - name: Build Next.js
#         working-directory: ./frontend
#         run: npm run build

#       # # 8. ë°°í¬ (SSH/SCP ì‚¬ìš©)
#       # #    ë¹Œë“œëœ .next í´ë”, node_modules, package.json ë“±ì„ ì„œë²„ë¡œ ë³µì‚¬
#       # - name: Deploy to Server via rsync
#       #   uses: appleboy/ssh-action@master
#       #   with:
#       #     host: ${{ secrets.SERVER_HOST }}
#       #     username: ${{ secrets.SERVER_USER }}
#       #     key: ${{ secrets.SERVER_SSH_KEY }}
#       #     port: 22
          
#       #     script: |
#       #       # 1. ì„œë²„ì— í”„ë¡œì íŠ¸ í´ë”ê°€ ìˆëŠ”ì§€ í™•ì¸/ìƒì„±
#       #       # (ë°±ì—”ë“œì™€ ë™ì¼í•œ VMì— ë°°í¬í•œë‹¤ê³  ê°€ì •)
#       #       mkdir -p /home/ubuntu/cjproject
#       #       cd /home/ubuntu/cjproject

#       #       # 2. ê¹ƒí—ˆë¸Œì—ì„œ ìµœì‹  ì½”ë“œ ë°›ê¸°
#       #       git pull origin main
            
#       #       # 3. (í•„ìˆ˜) Next.js ì„œë²„ ì¬ì‹œì‘
#       #       #    (ì„œë²„ì— pm2ê°€ ì„¤ì¹˜ë˜ì–´ ìˆê³ , 'frontend-app' ì´ë¦„ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì´ë¼ê³  ê°€ì •)
            
#       #       # 3-1. í”„ë¡ íŠ¸ì—”ë“œ í´ë”ë¡œ ì´ë™
#       #       cd frontend
            
#       #       # 3-2. (í•„ìˆ˜) ìš´ì˜ í™˜ê²½ìš© ì˜ì¡´ì„± ì„¤ì¹˜
#       #       npm install --production 
            
#       #       # 3-3. (í•„ìˆ˜) Next.js ì„œë²„ ì¬ì‹œì‘
#       #       pm2 restart frontend-app
            
#       #       # (ë§Œì•½ pm2ë¥¼ ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´)
#       #       # pm2 start npm --name "frontend-app" -- start